{% from 'macros.html' import img_modal %}
{% from 'macros.html' import replace_null %}
{% extends 'base.html' %}
{% block content %}
<div class="jumbotron jumbotron-fluid text-white mb-0" id="search-jumbo">
    <div class="container text-backdrop-dark" >
      <h1 class="display-4">Search Plants</h1>
      <p class="lead">Search by common name, species, or family and see what results you get, or use filters to narrow down the one million plants available through the the <a class="text-success" href="https://trefle.io/">trefle.io</a> API. Click the scientific name to see more details about the plant and add it to your Plant Lists!</p>
    </div>
</div>
<div class="container">

<div class="alert alert-light" role="alert">
    <div class="row">
        <div class="col-1 justify-content-center">
            <i class="fas fa-info-circle fa-3x"></i>
        </div>
        <div class="col">
            Information found here is still being updated may having missing or inaccurate data. Sources are listed for each plant on its profile page and corrections can be made <a href="https://docs.trefle.io/docs/advanced/complete-data/">here</a>.
        </div>
    </div>
</div>
<hr>

<form id="plant-form">

    <!-- <div class="form-group row">
        {{form.search.label(class_="col-sm-2 col-form-label")}}
        <div class="col-sm-10">
        {{form.search(class_="form-control")}}
        </div>
    </div>

    <div class="row">
        <div class="col-6">
            <h5 class="text-center">Filter</h5>
                {% for field in form if field.widget.input_type != 'hidden' %}
                    {% if field.type == 'BooleanField' %}
                    <div class="form-check">
                    
                    {{field(class_="form-check-input") }}
                    <label class="form-check-label">
                        
                        {{ field.label.text|safe }}
                        
                    </label>
                    </div>
        
                    {% endif %}
                {% endfor %}


            



        </div>
        <div class="col-6 border-left">
            <h5 class="text-center">Sort</h5>





        </div>





    </div> -->





    {{ form.hidden_tag() }}

    {% for field in form if field.widget.input_type != 'hidden' %}
      <div class="form-group">
        {% if field.type == 'BooleanField' %}
        <div class="form-check">
          
          {{field(class_="form-check-input") }}
          <label class="form-check-label">
            <b>{{ field.label.text|safe }}</b>
        </label>
        </div>
        
        {% else %}
       <b>{{field.label}}</b>
        {{field(class_="form-control")}}
        {% for err in field.errors %}
        <small class="form-text text-danger">
            {{err}}
        </small>
      {% endfor %}
      {% endif %}
    
    </div>
    {% endfor %}
<button class="btn btn-success btn-lg btn-block">Get Plants!</button>
</form>


<table id="plant-table" class="table my-3 table-hover">
    <thead>
        <tr>
            <th scope="col">Common Name</th>
            <th scope="col">Scientific Name</th>
            <th scope="col">Family</th>
            <th scope="col">Image</th>
        </tr>
    </thead>
    <tbody id="plant-table-body">

{% for plant in plantlist %}
    <tr>
        <td>
            <!-- Despite success in other areas, I cannot seem to replace of the null value here -->
            {% if (plant['common_name'] is not none and plant['common_name'] != null and plant['common_name'] != 'null' and plant['common_name'] != 'None') %}
                {{plant['common_name']|replace('null', 'No data available')}}
            {% else %}
                <i>No data available</i> 
            {% endif %}
            
        </td>
        <td><a href="{{url_for('plant_profile', plant_slug=plant['slug'])}}"><i>{{plant['scientific_name']}}</i></a></td>
        <td>{{plant['family_common_name']}}</td>
        <td>
        <!-- Thumbnail triggers img_modal -->
        <a type="button" data-toggle="modal" data-target="#{{plant['slug']}}-modal">
            <img id="table-plant-img" class="img-thumbnail" src="{% if plant['image_url'] == None %}/static/images/default-pic.png{% else %}{{plant['image_url']}}{% endif %}" alt="{{plant['common_name']}} image">
        </a>
        </td>
        {{img_modal(plant)}}



    </tr>
{% endfor %}
    </tbody>
</table>
<div id="no-results" class="container">

</div>
<nav aria-label="search results pagination">
    <ul class="pagination justify-content-center">
      <li id="page-first" class="page-item{% if not links.prev %} disabled{% endif %}">
        <a class="page-link" data-page="{{links.first}}">First</a>
      </li>
      <li id="page-prev" class="page-item{% if not links.prev %} disabled{% endif %}" >
        <a class="page-link" data-page="{{links.prev}}">Prev</a>
      </li>
      <li id="page-next" class="page-item{% if not links.next %} disabled{% endif %}"><a class="page-link" data-page="{{links.next}}">Next</a></li>
   
      <li id="page-last" class="page-item{% if not links.next %} disabled{% endif %}">
        <a class="page-link" data-page="{{links.last}}">Last</a>
      </li>
    </ul>
</nav>



{% endblock %}
{% block code %}
<script src="/static/plantSearch.js"></script>
<script src="/static/pagination.js"></script>
{% endblock %}
